# Architecture
<!--
"Strukturierte oder hieriachische Anordnung der Systemkomponenten sowie Beschreibung ihrer Beziehungen/Softwarearchitektur ist die Summe aller wichtigen Entscheidungen"
Kernfrage: Was soll technisch entwickelt werden?

Basis: Produktanforderungen etc.

-> Festlegung auf eingesetzte Technologien, Schnittstellen, Datenbanktechnologien, HMI Frameworks

Designtreiber (Aspekte die Architektur def.):

- Nicht-funktional: Barrierefreiheit, Migrationsfähigkeit, Performance
- Einsatzbedingungen: Nebenläufigkeit, Verteilt, Echtzeitfähig
- Umgebung: Zielplattform, Betriebssystem, Laufzeitumgebungen
- Qualität: Wiederverwendbarkeit, Akzeptable Fehlerraten

Unterteilung in folgende Grundsatzentscheidungen:
-->

<font color = "red"> 

## 0. Overall Architecture


YAAC uses MVVM as overall architecture. MVVM is short for Model-View-ViewModel which is a design pattern used in software development for building user interfaces. The advantage of mvvm is the separation of concerns between the data, presentation logic, and user interface. This separation makes the codebase easier to understand, maintain, and modify, as changes in one component do not directly impact the others.

The structure of mvvm can be viewed [here](/Diagrams/mvvm.uxf).

The model represent the data and business logic of the application as it contains the data and operations that are independent of the user interface. Models are objects that interact with the database, image processing and email integration to fetch data.

The view is the UI of the application. It displays the data from the ViewModel and sends user input back to the ViewModel for processing.

The ViewModel mediates between the Model and the View. It exposes data and commands from the Model to the View and handles user interactions from the View. ViewModels contain properties that represent the state of the UI and methods or commands to perform actions in response to user input.


## 1. HMI

### 1.1 Choice of Technology

The goal is to develop a cross-platform application. To make that happen, we use the tool Fyne to create the user interface. A HMI mockup was created using Figma.

### 1.2 Synchronization

YAAC checks every 30 minutes whether new emails have arrived. Therefore, the status of the emails is always up to date. The app continues to run in the background, even if it is not open on the desktop screen.

## 2. Distribution

We use a Fat Client as we run everything locally except for the mail integration. A possible add-on could be a cloud-based database integration, which would ensure data integrity as the the data will not be stored on one device only.

[deployment diagram](/Diagrams/DeploymentDiagram.uxf)

<!-- Fat Client, Client/Server, Web Architektur, Service orientierte Architektur, Microservices -->

## 3. Infrastructure

### 3.1 Operating Systems

To run the software on the end-users system `Docker` using WSL2 as virtualization (assuming that the user uses Windows 10/11). No further software should be necessary to install. WSL2 already has the basic capability build in to run X11-aware applications.

### 3.2 Programming Language

After we tested different programming languages and their compatibility to different frontend tools in the exploration sprints, we decided to use the programming language Go and combine it with the toolkit Fyne. The reasons for that are described in the subdivision [1.6.0 Exploration Sprints](/3rdTry/1PlanningPhase/1.6.0ExplorationSprints.md).

### 3.3 Libraries

### Go Standard Library

The Go Standard Library is structured in a modular fashion with each package addressing specific functionalities in a minimalist way. This enables the code's code organization, reusability and extensibility. As YAAC's programming language is Go, this library is used for many functions in the code.

### Tesseract
 
Tesseract is a highly accurate open source optical character recognition engine that converts images of text into machine-readable text. YAAC uses Tesseract to extract the text of the image of the attendance list.

### OpenCV

OpenCV, short for Open Source Computer Vision Library, is an open source computer vision and machine learning software library. YAAC uses OpenCV for the image processing component.

<!--

- Klassenbibliotheken stellen Funktionalitäten zur Verfügung, werden in Projekten eingebunden und benutzt Bereitstellen von Lösungen für Teilprobleme, aber kein Einfluss auf Architektur
 
Lizenzbedingungen beachten! (GPL, Copyleft, Apache, MIT,...)

Diagramme über alle Anwendungen und deren Funktionalitäten und welche Libs die verwenden
-->

<font color="red">

### 3.4 Frameworks

Fyne is an easy to use, cross-platform graphical use interface and app development framework written in Go. It allows developers to create native applications.

</font>


<!--
Stellen Funktionalitäten bereit (wie Bibliotheken), folgen Programmierparadigmen -> bestimmen Architektur

Wie? Bestenehd aus System kooperierender Klassen, Einsatz unter Anwendung der Porgrammierparadigmen (z.B. APM), Erweiterbarkeit wird durch Architektur vorgegeben (abstrakte Klassen, Schnittstellen, etc.)

Erweiterung konkret: Implementierung einer abstakten/abgeleiteten Klasse, Kontrollfliss des Frameworks bleibt bestehen

Falls Klasse von Problemen passend sind: Problemstellungen einfacher lösbar

mehr zu Frameworks in SWEng Skript unter Entwurfsphase

-->

### 3.5 Inter Process Communication

### 3.6 Communication Protocols

The email service implementation works via SMTP and IMAP.

### 3.7 Safety Aspects


</font>

## 4. Data Handling

### 4.1 Database

The user data are saved in a database using SQLight. The reasons for this decision are described in chapter [1.6.0 Exploration Sprints](/3rdTry/1PlanningPhase/1.6.0ExplorationSprints.md). 

### 4.2 Local/Central

The database is saved on the computer locally. An optional feature would be to implement the storage on a cloud as it would be better for data integrity.

### 4.3 Relational Database

The chosen database system is SQLite, which is a relational database.

For faster execution and security against SQL-Injection attacks it is crucial to use prepared statements wherever user input is parsed to an SQL statement. Prepared statements save resources and accept input variables only as values not as part of the sql statement. Their usage is described [here](https://go.dev/doc/database/prepared-statements).

The entity relationship diagram of the database shows a high level overview planned out with everyone involved. It defines all tables (Student, Attendance, AttendanceList), their attributes and their relations needed for the basic program and leaves expandability.

![ERM](https://github.com/DHBW-SE-2023/Wiki/blob/main/Diagrams/Database/DB-Entwurf.png "ERM high level overview of the database")

The data dictionary is described in the following:

### Course

| attribute name | data type |
| ------- | ------ |
| Name: string
| Students: []Student

---

### Student

| attribute name | data type |
| ------- | ------ |
| FirstName        | string required |
| LastName         | string required |
| CourseID         | uint |
| IsImmatriculated | bool |

---

### Attendance

| attribute name | data type |
| ------- | ------ |
| StudentID        | uint primaryKey |
| AttendanceListID | uint primaryKey |
| IsAttending      | bool |
| NameROI          | Rectangle |
| SignatureROI     | Rectangle |
| TotalROI         | Rectangle |

---

### AttendanceList

| attribute name | data type |
| ------- | ------ |
| CreatedAt    | time.Time, primaryKey |
| UpdatedAt    | time.Time |
| CourseID     | uint foreignKey:Id; references:Course |
| ReceivedAt   | time.Time |
| Attendancies | []Attendance |
| Image        | []byte // image as png |

---

### Setting

| attribute name | data type |
| ------- | ------ |
| Setting | string primaryKey |
| Value   | string |



Date is not a known type to sqlite but is can be represented as text in ISO8601 strings ("YYYY-MM-DD HH:MM:SS.SSS"). And build-in functions can produce such strings.


### 4.4 Backup/Replication

There is no backup database in the current project plan for YAAC. The images still would exist in the user's email inbox. The absent students have to be noted on a university owned system, therefore this part of the data would be saved as well. In conclusion a backup would be recommendable, but it's not required, which makes this aspect optional.

